// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Filial {
  id         Int          @id @default(autoincrement())
  nome       String       @db.VarChar(100)
  candidatos Candidato[]
  votos      Voto[]
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt

  @@map("filiais")
}

model Candidato {
  id       Int    @id @default(autoincrement())
  filialId Int    @map("filial_id")
  nome     String @db.VarChar(100)
  setor    String @db.VarChar(50)
  fotoUrl  String @map("foto_url") @db.VarChar(255)

  filial    Filial @relation(fields: [filialId], references: [id], onDelete: Cascade)
  votos     Voto[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("candidatos")
}

model Voto {
  id          Int      @id @default(autoincrement())
  filialId    Int      @map("filial_id")
  cadastro    String   @db.VarChar(50)
  cpf         String   @db.VarChar(11)
  candidatoId Int      @map("candidato_id")
  dataHora    DateTime @default(now()) @map("data_hora")

  filial    Filial    @relation(fields: [filialId], references: [id], onDelete: Cascade)
  candidato Candidato @relation(fields: [candidatoId], references: [id], onDelete: Cascade)

  @@unique([filialId, cadastro, cpf])
  @@map("votos")
}
